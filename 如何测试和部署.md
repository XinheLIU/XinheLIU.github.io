# 如何测试和部署Hexo博客

本文档提供了关于如何本地测试和部署Hexo博客到GitHub Pages的详细步骤。

## 前置条件

在开始之前，请确保已安装：

- Node.js (最低12.0版本)
- Git
- npm

## 安装Hexo和依赖

在首次设置时，请执行以下步骤：

```bash
# 全局安装Hexo命令行工具
npm install -g hexo-cli

# 安装项目依赖
npm install

# 安装git部署插件
npm install hexo-deployer-git --save
```

## 重新下载和测试Hexo

如果需要在新环境中重新搭建或重置现有Hexo博客，可以按照以下步骤操作：

### 1. 本地安装Hexo（无需管理员权限）

如果无法使用全局安装（例如权限问题），可以选择本地安装Hexo：

```bash
# 初始化npm项目
npm init -y

# 本地安装Hexo
npm install hexo hexo-cli

# 安装必要的插件
npm install hexo-server hexo-deployer-git
```

### 2. 初始化Hexo博客

如果是全新项目或需要重置博客：

```bash
# 使用npx确保使用本地安装的hexo命令
npx hexo init ./hexo-temp

# 将初始化的文件移动到当前目录
cp -r ./hexo-temp/* . 
cp -r ./hexo-temp/.* . 2>/dev/null || true 

# 删除临时目录
rm -rf ./hexo-temp
```

### 3. 生成和启动服务器

使用本地安装的Hexo命令：

```bash
# 清理和生成
npx hexo clean && npx hexo generate

# 启动调试服务器
npx hexo server --debug
```

### 4. 访问本地站点

在浏览器中访问：
```
http://localhost:4000
```

这样你就可以预览重新搭建的博客了。

## 使用主题美化博客

Hexo提供了丰富的主题选择，本节以hexo-theme-matery为例，介绍如何安装和配置一个美观的博客主题。

### 1. 安装matery主题

```bash
# 克隆matery主题到themes目录
git clone https://github.com/blinkfox/hexo-theme-matery.git themes/matery

# 安装主题所需插件
npm install --save hexo-prism-plugin hexo-wordcount
```

### 2. 配置主题

编辑站点配置文件`_config.yml`，修改主题设置：

```yaml
# 将主题修改为matery
theme: matery

# 开启文章资源文件夹
post_asset_folder: true

# 配置代码高亮
syntax_highlighter: prismjs
highlight:
  enable: false
prismjs:
  enable: true
  preprocess: true
  line_number: true
  tab_replace: ''

# 添加Prism插件配置
prism_plugin:
  mode: 'preprocess'
  theme: 'tomorrow'
  line_number: false
```

### 3. 创建主题所需页面

matery主题需要一些特定页面才能正常显示菜单：

```bash
# 创建关于页面
npx hexo new page "about"

# 创建联系页面
npx hexo new page "contact"

# 创建友情链接页面
npx hexo new page "friends"
```

然后编辑这些页面，添加`type`和`layout`字段：

```markdown
---
title: 关于我
date: 2023-01-01
type: "about"
layout: "about"
---

个人介绍内容...
```

### 4. 自定义主题配置

编辑主题配置文件`themes/matery/_config.yml`，可以修改以下内容：

- 导航菜单
- 首页轮播图
- 网站颜色方案
- 社交链接
- 文章特色图
- 页脚信息

### 5. 预览主题效果

```bash
# 清理和生成
npx hexo clean && npx hexo generate

# 启动服务器
npx hexo server
```

访问`http://localhost:4000`查看主题效果。

## 使用Git管理博客源文件

使用Git可以帮助跟踪博客源码的变更历史，并便于在多设备之间同步。针对Hexo博客，推荐使用单仓库双分支的管理方式，即使用同一个仓库的不同分支分别管理源码和部署文件。

### 1. 创建分支结构

在GitHub上创建的`username.github.io`仓库中，使用两个分支：
- `main`分支: 存放生成的静态网站文件，由GitHub Pages自动部署
- `source`分支: 存放Hexo的源文件、配置及主题

### 2. 配置.gitignore文件

创建或修改`.gitignore`文件，排除不需要版本控制的文件：

```
.DS_Store
Thumbs.db
db.json
*.log
node_modules/
public/
.deploy*/
.idea/
.vscode/
*.swp
*.swo
```

### 3. 初始化源码分支

```bash
# 创建并切换到source分支
git checkout -b source

# 添加所有Hexo源文件
git add .

# 如果主题目录包含.git，需要移除
rm -rf themes/主题名/.git

# 提交更改
git commit -m "初始化Hexo源码到source分支"

# 推送到远程仓库
git push -u origin source
```

### 4. 配置部署设置

确保Hexo配置文件`_config.yml`中的部署设置正确指向main分支：

```yaml
deploy:
  type: git
  repo: https://github.com/你的用户名/你的用户名.github.io.git
  branch: main  # 部署到main分支
```

### 5. 日常工作流程

在`source`分支上进行博客内容的编辑和主题调整：

```bash
# 切换到source分支
git checkout source

# 编辑文章、修改配置等...

# 本地预览
npx hexo clean && npx hexo server

# 提交更改
git add .
git commit -m "更新博客内容"
git push origin source

# 部署到main分支
npx hexo clean && npx hexo deploy
```

### 6. 在其他设备上克隆和工作

在新设备上工作时，只需要克隆`source`分支：

```bash
# 克隆source分支
git clone -b source https://github.com/你的用户名/你的用户名.github.io.git

# 进入目录
cd 你的用户名.github.io

# 安装依赖
npm install

# 开始工作...
```

这样的分支策略让你能够：
1. 完整保留Hexo博客的源码
2. 在任何设备上轻松还原和继续工作
3. 维护清晰的更改历史
4. 分离内容源码和生成的静态文件

## 本地测试

### 1. 生成和预览

执行以下命令清理、生成和启动本地服务器：

```bash
# 清理之前生成的文件
hexo clean

# 生成静态文件
hexo generate
# 或使用简写
hexo g

# 启动本地服务器
hexo server
# 或使用简写
hexo s
```

也可以使用组合命令：

```bash
hexo clean && hexo g && hexo s
```

### 2. 访问本地站点

启动服务器后，在浏览器中访问：
```
http://localhost:4000
```

这样你就可以在本地预览你的博客了。

### 3. 开发模式

如果你想要在编辑文件时实时刷新预览，可以使用：

```bash
hexo s --debug
```

## 部署到GitHub Pages

### 1. 创建GitHub仓库

首先，你需要创建一个特殊的GitHub仓库，名称为：`你的用户名.github.io`

例如，如果你的GitHub用户名是`example`，那么仓库名应该是`example.github.io`。

### 2. 配置部署设置

在博客根目录的`_config.yml`文件中，确保正确配置了部署信息：

```yaml
deploy:
  type: git
  repo: https://github.com/你的用户名/你的用户名.github.io.git
  branch: main  # 或者使用 master，取决于你的GitHub仓库默认分支
```

### 3. 部署命令

执行以下命令进行部署：

```bash
# 清理之前生成的文件
hexo clean

# 生成静态文件并部署
hexo generate --deploy
# 或使用简写
hexo g -d
# 或
hexo d -g
```

也可以使用组合命令：

```bash
hexo clean && hexo deploy
# 或简写
hexo clean && hexo d
```

### 4. 访问线上博客

部署完成后，等待几分钟，然后访问你的GitHub Pages站点：
```
https://你的用户名.github.io
```

## 常见问题

### 部署认证失败

如果你遇到GitHub认证失败的问题，可能需要配置SSH密钥或使用个人访问令牌。请参考GitHub文档：
- [配置SSH密钥](https://docs.github.com/cn/authentication/connecting-to-github-with-ssh)
- [创建个人访问令牌](https://docs.github.com/cn/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token)

### 部署后样式丢失

如果部署后页面样式丢失，请检查`_config.yml`中的`url`和`root`配置是否正确：

```yaml
url: https://你的用户名.github.io
root: /
```

### 部署后404错误

如果遇到404错误，请检查：
1. GitHub Pages是否已启用（在仓库设置中确认）
2. 是否部署到了正确的分支
3. 仓库名称是否正确（应为`你的用户名.github.io`）

## 更新博客

创建新文章：

```bash
hexo new "文章标题"
```

编辑完成后，重复上述部署步骤即可更新你的博客。 